Abbadon RAT,,,
74f58ab637713ca0463c3842cd71176a887b132d13d32f9841c03f59c359c6d7,,,
GetAuths,Fig1,The sample will try to find the token in Discord’s log files and tries to validate it through Discord’s API (https[:]//discord.com/api/v8/users/@me).,
,,"And extract any useful information it has, including the victim’s MFA code.",
ParseLog,Fig2,The sample will try to find the token in Discord’s log files and tries to validate it through Discord’s API (https[:]//discord.com/api/v8/users/@me).,
Checktoken,Fig3,"Finally, before sending the token back to the C2, it will try to validate it through Discord’s API.",
GetSessionFiles,Fig4,"The following method will read any session Steam files to obtain the username, installed apps, cookies and password if it has been saved.",
GetLoginFromCookies,Fig5,"The sample will also try to use any Steam related cookies it might have obtained, to send a GET request to Steam, in an attempt to validate the cookies it has gotten.",
,,"If successful, it will send back the cookie, email associated with that account, username, and balance in Steam wallet.",
GetCookies,Fig6,"The way it does this, is simply by running SQL queries on the Chromium DB.",
,,"Like a lot of other “stealers”, this malware will try to extract the following data from Chromium DB: Cookies, Credit cards, Logins",
GetCreditCards,Fig7,"The way it does this, is simply by running SQL queries on the Chromium DB.",
,,"Like a lot of other “stealers”, this malware will try to extract the following data from Chromium DB: Cookies, Credit cards, Logins",
?,Fig8,-,
?,Fig9,-,
?,Fig10,-,
,,,
Babuk Ransomware,,,
8203c2f00ecd3ae960cb3247a7d7bfb35e55c38939607c85dbdb5c92f0495fa9,,,
FUN_00404620,Fig1,"Using CreateToolhelp32Snapshot, Process32FirstW, and Process32NextW to investigate all of the running processes on the system, Babuk can iterate and search for processes that need to be closed.", 
,,"It will execute TerminateProcess to terminate any found processes. Here is the list of processes to be closed: sql.exe, oracle.exe, ocssd.exe, dbsnmp.exe, synctime.exe, agntsvc.exe, isqlplussvc.exe, xfssvccon.exe, mydesktopservice.exe, ocautoupds.exe, encsvc.exe, firefox.exe, tbirdconfig.exe, mydesktopqos.exe, ocomm.exe, dbeng50.exe, sqbcoreservice.exe, excel.exe, infopath.exe, msaccess.exe, mspub.exe, onenote.exe, outlook.exe, powerpnt.exe, steam.exe, thebat.exe, thunderbird.exe, visio.exe, winword.exe, wordpad.exe, notepad.exe",
FUN_00402d30,Fig2,Babuk attempts to remove shadow duplicates prior to and following encryption.,
,,Before invoking ShellExecuteW to execute the following command: cmd.exe /c vssadmin.exe delete shadows /all /quiet,
,,Wow64DisableWow64FsRedirection is called to disable file system redirection.,
,,"After removing the shadow copies, Babuk verifies whether the system is powered by a 64-bit processor. If so, Wow64RevertWow64FsRedirection is invoked to re-enable file system redirection.",
FUN_00402a30,Fig3,Babuk will call EnumDependentServicesA prior to terminating a service to retrieve the name and status of each dependent service.,
,,"It will then invoke ControlService with the control code SERVICE_CONTROL_STOP to halt them prior to terminating the primary service in the same manner. List of sevices: vss, sql, svc$, memtas, mepocs, sophos, veeam, backup, GxVss, GxBlr, GxFWD, GxCVD, GxCIMgr, DefWatch, ccEvtMgr, ccSetMgr, SavRoam, RTVscan, QBFCService, QBIDPService, Intuit.QuickBooks.FCS, QBCFMonitorService, YooBackup, YooIT, zhudongfangyu, sophos, stc_raw_agent, VSNAPVSS, VeeamTransportSvc, VeeamDeploymentService, VeeamNFSSvc, veeam, PDVFSService, BackupExecVSSProvider, BackupExecAgentAccelerator, BackupExecAgentBrowser, BackupExecDiveciMediaService, BackupExecJobEngine, BackupExecManagementService, BackupExecRPCService, AcrSch2Svc, AcronisAgent, CASAD2DWebSvc, CAARCUpdateSvc",
FUN_00402ae0,Fig4,Babuk generates four random buffers using RtlGenRandom: RtlGenRandom - This function is available as a resource named SystemFunction036 in Advapi32.dll.,
FUN_004034b0,Fig5,It navigates through each directory by using the FindFirstFileW and FindNextFileW methods in order to search for files and subdirectories.,
,,"When it comes across a file, it will perform a check to see if the file name is How To Restore Your data.txt or if the file extension is __NIST_K571__.",
FUN_00404620,Fig6,-,
entry,,-,
,,,
BPFDoor,,,
afa8a32ec29a31f152ba20a30eb483520fe50f2dce6c9aa9135d88f7c9c511d7,,,
FUN_00401380,Fig1,"When executed, the BPFdoor sample will attempt to create and get a lock on a runtime file at “/var/run/initd.lock” and will exit if it fails using that file as a makeshift mutex.",
FUN_00401380,Fig3,"Having set up the above, BPFdoor then allocates a memory buffer and creates a socket as follows: int32_t socket(enum __socket_domain domain, enum __socket_type type, int32_t protocol) 00401370  return socket(domain: domain, type: type, protocol: protocol) __tailcall call    malloc // protocol mov     edx, 0x300 // type mov     esi, 0x3 // domain mov     edi, 0x11 mov     rbx, rax call    socket",
FUN_00401a30,Fig5,"It will proceed to specify the following socket options using setsockopt: int32_t setsockopt(int32_t sockfd, int32_t level, int32_t optname, void const* optval, socklen_t optlen) 004010a0  return setsockopt(sockfd: sockfd, level: level, optname: optname, optval: optval, optlen: optlen) __tailcall mov     ecx, 0x1e        // optlen mov     r8d, 0x10 rep movsq qword [rdi], [rsi]   {0x0} // optname mov     edx, 0x1a mov     rcx, rsp {var_108}     // optval // level mov     esi, 0x1 mov     edi, r9d              // fd mov     qword [rsp+0x8 {var_100}], rax {var_f8} call    setsockopt",
FUN_00401380,Fig7,"And will read from it in a loop (further described below) using recvfrom: ssize_t recvfrom(int32_t fd, void* buf, size_t len, int32_t flags, union __SOCKADDR_ARG addr, socklen_t* addrlen) 00401250  return recvfrom(fd: fd, buf: buf, len: len, flags: flags, addr: addr, addrlen: addrlen) __tailcall",
,,,
,opcode,,
,,,
,,,
Emotet,,,
76816ba1a506eba7151bce38b3e6d673362355063c8fd92444b6bec5ad106c21,,,
FUN_10005680,Fig1,The function then allocates memory based on the size of the resource and goes through some decryption loops.,
,Fig2,-,
,,,
,,,
,,,
,opcode,,
,,,
Emotet2,,,
249269aae1e8a9c52f7f6ae93eb0466a5069870b14bf50ac22dc14099c2655db,,,
FUN_00401f80,Fig1,It uses GetProcAddress to find the address of VirtualAllocExNuma and calls it to allocate memory for the payload.,
,Fig2,"It calculates the parameters for VirtualAllocExNuma during runtime, to hide the allocation of RWX memory.",
,,"The function atoi is being used to convert the string “64” to int, which is PAGE_EXECUTE_READWRITE.",
,,"Also, the string “8192” is converted to 0x3000 which means the memory is allocated with the flags MEM_COMMIT and MEM_RESERVE.",
,Fig3,The payload is then copied from the .data section to the RWX memory (that is where our breakpoint hit).,
,,The decryption routine is being called and then the shellcode is being executed.,
,,,
,,,
,opcode,,
,,,
,,,
IISerpent,,,
aa34ecb2922ce8a8066358a1d0ce0ff632297037f8b528e3a37cd53477877e47,,,
FUN_10009a60,Fig1,"IISerpent recognizes search engine crawler requests by parsing the User-Agent header and looking for specific substrings. push    offset aUserAgent     ; \""User-Agent\"" mov     ecx, edi mov     edx, [eax+IHttpRequestVtbl.GetHeader] call    edx push    offset aSpider        ; \""spider\"" lea     ecx, [ebp+userAgentHeaderValue] ; Str call    findSubstring push    offset aBot           ; \""bot\"" lea     ecx, [ebp+userAgentHeaderValue] ; Str call    findSubstring",
,,"If the redirecturl field is configured, the malware redirects all requests with the strings spider or bot in the User-Agent header to this URL by setting the Location header in the HTTP response.",
,,,
,,,
,,,
Racoon Stelaer,,,
0123b26df3c79bac0a3fda79072e36c159cfd1824ae3fd4b7f9dea9bda9c7909,,,
FUN_00401000,Fig3,This function simply uses the GetProcAddress API function to load the address of the functions it will need.,
,,"A few of these functions immediately catch my eye, those being the internet related functions highlighted: InternetConnectW, InternetOpenW, InternetReadFile, InternetCloseHandle, HttpOpenRequestW, HttpSendRequestW",
entry,Fig4,The malware also obfuscates its strings using Base64 encoding and RC4 encryption.,
,,"Once the strings are decrypted, the malware then performs the same decryption routine for the C2 IP address(s_1IdAg3LYd/aKTgV0hVw1NF5b_0040d460), but using a different RC4 key(s_403f7b121a3afd9e8d27f945140b8a92_0040d43c).",
entry,Fig6,"Next, the malware checks to see if another instance of it is already running on the infected machine by opening a mutex with the value of 8724643052.",
,,"If the OpenMutexW function fails and returns a 0, the malware creates a mutex with the value, then continues execution. If the function succeeds and returns 1 (true), the malware exits.",
FUN_0040a198,Fig7,"The malware also checks if it is running as SYSTEM by comparing the current process’s token to the SYSTEM SID, S-1–5–18.",
FUN_0040a2d7,Fig8,"If the malware is running as SYSTEM, it then calls a process enumeration function using CreateToolHelpSnapshot32, Process32First, and Process32Next. If the malware is not running with SYSTEM privileges, it simply skips over the process enumeration function and continues with its execution.",
FUN_0040a720,Fig9,"Before connecting to the C2 node, the malware will retrieve the host’s GUID by querying the SOFTWARE\\Microsoft\\Cryptography registry key.",
,,"The malware also retrieves the current user’s username, and moves it along with the machine ID, onto the heap before contacting the C2 node.",
entry,Fig11,"The malware then checks to see if the response from the C2 node is larger than 0x3f (63 in decimal) characters long. If it is, the malware continues execution. If not, the malware breaks out of the loop and exits.",
entry,Fig12,-,
FUN_0040a323,Fig13,"It is at this point that the malware would perform the bulk of its stealing functionality, including cookies, passwords, credit card data, passwords, browser history, etc.",